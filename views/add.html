{% extends "article-layout.html" %} {% block main %}
<link rel="stylesheet" type="text/css" href="../static/css/fileinput.css" />
<link rel="stylesheet" type="text/css" href="../static/css/font-awesome/css/font-awesome.css" />
<link rel="stylesheet" type="text/css" href="../static/css/custom_up_img.css" />
<link rel="stylesheet" type="text/css" href="../static/css/sweetalert.css" />
<link rel="stylesheet" type="text/css" href="../static/css/add.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
<script src="../static/js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
<script src="../static/js/fileinput.js" type="text/javascript" charset="utf-8"></script>
<script src="../static/js/custom_up_img.js" type="text/javascript" charset="utf-8"></script>
<script src="../static/js/cropper.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../static/js/zh.js" type="text/javascript" charset="utf-8"></script>
<script src="../static/js/sweetalert-dev.js" type="text/javascript" charset="utf-8"></script>
<div class="container" style="margin-top: 15px;">
	<div class="row">
		<form method="post">
			<div class="content-head">
				<span>标题</span>
				<input type="text" name="title" class="form-control" />
				<button type="submit" class="btn" style="background: #42B983; color: #FFF;">发布</button>
			</div>
			<span style="line-height: 30px;">内容摘要</span><br>
			<textarea id="description" class="form-control" rows="3" name="description"></textarea>
			<br>
			<span style="line-height: 20px;">文章正文</span><br>
			<textarea id="article-content" class="form-control" rows="20" name="content"></textarea>
			<br />
			<input type="hidden" name="coverImage" id="coverImage" value="" />
		</form>
		<span>封面图(<small>可以不上传</small>)：</span>
		<input type="file" name="file" id="cover" required="required" />
		<br />
		<input type="button" name="uploadImage" id="coverBtn" value="上传" class="btn btn-default" />
		<p>1、图片大小不能超过2M，2、支持格式：.jpg .png .bmp</p>
	</div>
	<!--上传图片-->
	<div class="modal fade" id="uploadImg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h4 class="modal-title" id="myModalLabel">插入图片</h4>
				</div>
				<div class="modal-body">
					<div id="myTabContent" class="tab-content">
						<div class="tab-pane fade in active" id="upload">
							<br />
							<input type="file" name="file" id="file" required="required" />
							<br />
							<input type="button" name="uploadImage" id="uploadImage" value="上传" class="btn btn-mybtn" />
							<p>1、图片大小不能超过2M，2、支持格式：.jpg .png .bmp</p>
							<p>图片链接：<small style="color: #42B983;">(上传成功后请复制当前图片链接进行添加)</small></p>
							<input type="text" name="online" id="online" class="form-control"/>
							<br />
							<div id="successTip">
								<i class="fa fa-check"></i>上传成功
							</div>
						</div>
					</div>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-mybtn" id="insertImg" data-dismiss="modal" style="background: #42B983; color: #FFF;">确定</button>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>
</div>
</div>
<script type="text/javascript">
	var simplemde = new SimpleMDE({
		element: document.getElementById('article-content'),
		placeholder: '输入正文...'
	});
	$('.fa-picture-o').attr('data-toggle', 'modal');
	$('.fa-picture-o').attr('data-target', '#uploadImg');
	$("#file").fileinput({
		language: 'zh',
		'theme': 'explorer',
		'uploadUrl': '#',
		showUpload: false, //是否显示上传按钮
		showRemove: false,
		overwriteInitial: false,
		dropZoneEnabled: false, //是否显示拖拽区域
		browseClass: "btn btn-default", //按钮样式  
		allowedFileExtensions: ['jpg', 'png', 'bmp']
	});
	$("#cover").fileinput({
		language: 'zh',
		'theme': 'explorer',
		'uploadUrl': '#',
		showUpload: false, //是否显示上传按钮
		showRemove: false,
		overwriteInitial: false,
		dropZoneEnabled: false, //是否显示拖拽区域
		browseClass: "btn btn-default", //按钮样式  
		allowedFileExtensions: ['jpg', 'png', 'bmp']
	});
	$('#coverBtn').click(function() {
		var img = $('#cover').get(0).files[0];
		if(!/image\/\w+/.test(img.type)) {
			alert("请确保文件为图像类型");
			return false;
		}
		var reader = new FileReader();
		reader.onload = function(e) {
			//			console.log(e.target.result);
			$.ajax({
				type: "post",
				url: "/uploadImage",
				data: {
					type: 'coverimg',
					data: e.target.result.toString()
				},
				dataType: 'json',
				success: function(data) {
					if(data.result == 'ok') {
						alert('上传成功');
						$('#coverImage').val(data.image);
					}
				}
			});
		}
		reader.readAsDataURL(img);
	});
	$('#uploadImage').click(function() {
		var img = $('#file').get(0).files[0];
		//					console.log(img);
		if(!/image\/\w+/.test(img.type)) {
			alert("请确保文件为图像类型");
			return false;
		}
		var reader = new FileReader();
		reader.onload = function(e) {
			//						console.log(e.target.result);
			$.ajax({
				type: "post",
				url: "/uploadImage",
				data: {
					type: 'contentimg',
					data: e.target.result.toString()
				},
				dataType: 'json',
				success: function(data) {
					console.log(data);
					if(data.result == 'ok') {
						$('#online').val(data.image);
						$('#successTip').show();
					}
				}
			});
		}
		reader.readAsDataURL(img);
	});
</script>
{% endblock %}